<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Brasil</title>
	<link rel="stylesheet" href="/static/bootstrap.min.css">
	<link rel="stylesheet" href="/static/helper.css">
</head>
<body>

	<a href="https://github.com/gammasoft/brasil"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>

	<div class="container">
		<div class="row">
			<div class="col-md-offset-3 col-md-6 col-xs-12">
				<h1>
					Brasil
				</h1>
				<p class="lead">
					Exemplo de consulta a receita federal
				</p>
			</div>
		</div>

		<div class="row">
			<div class="col-md-offset-3 col-md-6 col-xs-12">
			    <div class="input-group">
			      	<input id="cnpj" type="text" class="form-control" placeholder="CNPJ">
			      	<span class="input-group-btn">
			        	<button id="resolverCaptcha" class="btn btn-default" type="button">CONSULTAR</button>
			    	</span>
			    </div>
			</div>
		</div>

		<div class="row" style="margin-top: 10px;">
			<div class="col-md-offset-3 col-md-6 col-xs-12">
				<pre id="resultado" style="display: none;"></pre>
				<p class="text-center">
					<b>&gamma; Gammasoft Desenvolvimento de Software Ltda</b><br />
					<a href="mailto:contato@gammasoft.com.br">contato@gammasoft.com.br</a> - <a id="newsletter" href="#">Notifique-me a cada nova versão</a>
				</p>
			</div>
		</div>
	</div>

	<div class="modal fade" id="newsletterModal" tabindex="-1" role="dialog" aria-labelledby="newsletterModalLabel" aria-hidden="true">
	    <div class="modal-dialog">
	        <div class="modal-content">
	            <div class="modal-header">
	                <button type="button" class="close" data-dismiss="modal">
	                    <span aria-hidden="true">&times;</span>
	                    <span class="sr-only">Fechar</span>
	                </button>

	                <h4 class="modal-title" id="newsletterModalLabel">Inscreva-se</h4>
	            </div>

	            <div class="modal-body">
	                Seja notificado a cada atualização do módulo Brasil (via MailChimp)

					<!-- Begin MailChimp Signup Form -->
					<form style="margin-top: 10px;" action="//github.us9.list-manage.com/subscribe/post?u=513e70b6c8253e9c9d281b161&amp;id=8f0a0f188b" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
					    <div id="mc_embed_signup_scroll">
						<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="Seu e-mail" required>
					    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
					    <div style="position: absolute; left: -5000px;"><input type="text" name="b_513e70b6c8253e9c9d281b161_8f0a0f188b" tabindex="-1" value=""></div>
					    <div class="clear"><input type="submit" value="Enviar" name="subscribe" id="mc-embedded-subscribe" style="margin-top: 10px;" class="btn btn-default"></div>
					    </div>
					</form>

					<!--End mc_embed_signup-->
	            </div>
	        </div>
	    </div>
	</div>

	<div class="modal fade" id="captchaModal" tabindex="-1" role="dialog" aria-labelledby="captchaModalLabel" aria-hidden="true">
	    <div class="modal-dialog modal-sm">
	        <div class="modal-content">
	            <div class="modal-header">
	                <button type="button" class="close" data-dismiss="modal">
	                    <span aria-hidden="true">&times;</span>
	                    <span class="sr-only">Fechar</span>
	                </button>

	                <h4 class="modal-title" id="captchaModalLabel">Solucione o captcha...</h4>
	            </div>

	            <div class="modal-body">
	                <center>
	                	<img src="" alt="" id="captcha">
	                	<br />
	                	<br />
	                	<input maxlength="6" type="text" id="solucaoDoCaptcha">
	                </center>
	            </div>

	            <div class="modal-footer">
	                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
	                <button id="enviarConsulta" type="button" class="btn btn-primary">Enviar</button>
	            </div>
	        </div>
	    </div>
	</div>

	<script type="text/javascript" src="/static/jquery.min.js"></script>
	<script type="text/javascript" src="/static/bootstrap.min.js"></script>
	<script type="text/javascript" src="/static/maskedinput.min.js"></script>
	<script type="text/javascript" src="/static/helper.js"></script>
	<script type="text/javascript">
	$(function() {
		$('#cnpj').mask('99.999.999/9999-99');

		$('a#newsletter').bind('click', function() {
			$('#newsletterModal').modal('show');
		});

		$('#resolverCaptcha').on('click', function() {
			$('#resultado').hide();
			$('#resultado').html('');
			$('#solucaoDoCaptcha').val('')

			var get = $.getJSON('/captcha');

			get.success(function(captcha) {
				$('#captcha').attr('src', [
					'data:',
					captcha.contentType,
					';base64,',
					captcha.captchaEmBase64
				].join(''));

				$('#enviarConsulta').data('captcha', captcha);
				$('#captchaModal').modal('show');
			});
		});

		$('#enviarConsulta').on('click', function() {
			var get = $.getJSON('/consulta', $.extend({
					cnpj: $('#cnpj').val(),
					solucao: $('#solucaoDoCaptcha').val()
				}, $(this).data('captcha')));

			get.success(function(dados) {
				$('#resultado').html(pretty(dados));
				$('#resultado').show();
				$('#captchaModal').modal('hide');
			});

			get.fail(function(jqXHR, textStatus, errorThrown) {
				$('#captchaModal').modal('hide');
				alert('A solução do captcha estava incorreta ou o CNPJ não existe');
			});
		});
	});
	</script>
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-56091962-1', 'auto');
	  ga('send', 'pageview');
	</script>
</body>
</html>